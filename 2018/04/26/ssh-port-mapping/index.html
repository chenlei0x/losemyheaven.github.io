<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="port,ssh,map," />










<meta name="description" content="SSH port mappingSSH local port mapping -L[_bind_address_:]port:host:hostportSpecifies that the given port on the local (client) host is to be forwarded to the given host and hostport on the remote sid">
<meta name="keywords" content="port,ssh,map">
<meta property="og:type" content="article">
<meta property="og:title" content="ssh port mapping">
<meta property="og:url" content="http://losemyheaven.github.io/2018/04/26/ssh-port-mapping/index.html">
<meta property="og:site_name" content="Larry&#39;s Blog">
<meta property="og:description" content="SSH port mappingSSH local port mapping -L[_bind_address_:]port:host:hostportSpecifies that the given port on the local (client) host is to be forwarded to the given host and hostport on the remote sid">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://github.com/losemyheaven/image-bank/raw/master/ssh/ssh-L.jpg">
<meta property="og:image" content="https://github.com/losemyheaven/image-bank/raw/master/ssh/ssh-R.jpg">
<meta property="og:image" content="https://github.com/losemyheaven/image-bank/raw/master/ssh/ssh-D.jpg">
<meta property="og:updated_time" content="2018-08-03T14:41:09.278Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ssh port mapping">
<meta name="twitter:description" content="SSH port mappingSSH local port mapping -L[_bind_address_:]port:host:hostportSpecifies that the given port on the local (client) host is to be forwarded to the given host and hostport on the remote sid">
<meta name="twitter:image" content="https://github.com/losemyheaven/image-bank/raw/master/ssh/ssh-L.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://losemyheaven.github.io/2018/04/26/ssh-port-mapping/"/>





  <title>ssh port mapping | Larry's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Larry's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://losemyheaven.github.io/2018/04/26/ssh-port-mapping/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Larry Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Larry's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">ssh port mapping</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-26T15:06:41+08:00">
                2018-04-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/network/" itemprop="url" rel="index">
                    <span itemprop="name">network</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="SSH-port-mapping"><a href="#SSH-port-mapping" class="headerlink" title="SSH port mapping"></a>SSH port mapping</h1><h2 id="SSH-local-port-mapping"><a href="#SSH-local-port-mapping" class="headerlink" title="SSH local port mapping"></a>SSH local port mapping</h2><blockquote>
<p><strong>-L</strong><br>[_bind_address_:]<code>port</code>:<code>host</code>:<code>hostport</code><br>Specifies that the given <code>port</code> on the local (client) host is to be forwarded to the given <code>host</code> and <code>hostport</code> on the remote side.<br>This works by allocating a socket to listen to <code>port</code> on the local side, optionally bound to the specified _bind_address_. Whenever a connection is made to this port, the connection is forwarded over the secure channel, and a connection is made to <code>host</code> port <code>hostport</code> from the remote machine. Port forwardings can also be specified in the configuration file. </p>
</blockquote>
<p>This is useful when you want to access a remote host within a LAN by jumping from a gateway.<br><code>ssh -L port:host:hostport remote</code> will help you to map <code>host:hostport</code> to your local <code>port</code>. </p>
<blockquote>
</blockquote>
<p><img src="https://github.com/losemyheaven/image-bank/raw/master/ssh/ssh-L.jpg" alt="enter image description here"></p>
<h3 id="Usage"><a href="#Usage" class="headerlink" title="Usage:"></a>Usage:</h3><p>A host M exports port 22 as its ssh service port, and its ip is 192.168.1.100.<br>A remote host R also run ssh service with 22 port, and it has two ip <code>192.168.1.200</code> and <code>10.67.1.200/24</code><br>Local machine(10.67.1.1/24) could not directly access host M because they are in the different LAN.<br>After executing <code>ssh -L 1080:192.168.1.100:22  10.67.1.200</code>, you can use <code>ssh localhost:1080</code> to directly access ssh server running on host M.</p>
<a id="more"></a> 
<p> <code>ssh -L 1080:192.168.1.100:22  10.67.1.200</code> means:</p>
<ol>
<li>local client will listen 1080 port</li>
<li>when data is sent from 9999 port to local 1080 port, it will be transfered to ssh server through ssh tunnel</li>
<li>ssh server unpacks the data, and change the ip package header from source ip:port to 192.168.1.200:[new port] and then send the data package to 192.168.1.100:22. And also ssh server <strong>must</strong> record the [new port] is mapped to 10.67.1.1:9999. </li>
<li>some process will listen on 192.168.1.100:22, and when it receive data, it will reply to the source address 192.168.1.200:[new port].</li>
<li>ssh server retransfer data received from [new port] to 10.67.1.1:9999</li>
</ol>
<h3 id="Note-that-there-is-an-address-change-in-step-3-why-such-a-change-is-needed"><a href="#Note-that-there-is-an-address-change-in-step-3-why-such-a-change-is-needed" class="headerlink" title="Note that there is an address change in step 3, why such a change is needed?"></a>Note that there is an address change in step 3, why such a change is needed?</h3><p>This is a similar tech in NAT(net address translation) wildly used in our routers.<br>Because if source address is not changed, the process listening on 192.168.1.100:22 will directly reply to the source address 10.67.1.100:9999. However since there is not any rule to describe how to reach this address, it will fail.</p>
<h2 id="SSH-remote-port-mapping"><a href="#SSH-remote-port-mapping" class="headerlink" title="SSH remote port mapping"></a>SSH remote port mapping</h2><p><img src="https://github.com/losemyheaven/image-bank/raw/master/ssh/ssh-R.jpg" alt="enter image description here"></p>
<blockquote>
<p><strong>-R</strong><br>[_bind_address_:]<code>port</code>:<code>host</code>:<code>hostport</code><br>Specifies that the given <code>port</code> on the remote (server) host is to be forwarded to the given <code>host</code> and <code>hostport</code> on the local side. This works by allocating a socket to listen to  <code>port</code>  on the remote side, and whenever a connection is made to this port, the connection is forwarded over the secure channel, and a connection is made to  <code>host</code>  port  <code>hostport</code> from the local machine.<br>By default, the listening socket on the server will be bound to the loopback interface only. This may be overridden by specifying a  _bind_address_. An empty  _bind_address_, or the address ‘*’, indicates that the remote socket should listen on all interfaces. Specifying a remote  _bind_address_  will only succeed if the server’s  <strong>GatewayPorts</strong>  option is enabled (see  <strong><a href="https://linux.die.net/man/5/sshd_config" target="_blank" rel="noopener">sshd_config</a></strong>(5)).<br>If the  <em>port</em>  argument is ‘0’, the listen port will be dynamically allocated on the server and reported to the client at run time.</p>
</blockquote>
<p>Ha, more funny than ssh local port map.<br>They are quit similar, but work in different way.<br>Now ssh server will listen on both port 22 and <code>port</code> you specifie. on ssh server, <code>host</code>:<code>hostport</code> will be mapped to localhost:<code>port</code> on ssh server side.<br>Data sent to <code>port</code> will be received by ssh server and then be transfer through ssh tunnel. Then ssh client gets data and send to <code>host</code>:<code>hostport</code> with address translation mappings recorded as described above.</p>
<p>Have you ever considered that if you have a host with an public ip, and your local machine could connect it, how can you access local machine from the ‘public’ machine?<br>The answer is using ssh remote port mapping.</p>
<h1 id="SSH-dynamic-port-mapping"><a href="#SSH-dynamic-port-mapping" class="headerlink" title="SSH dynamic port mapping"></a>SSH dynamic port mapping</h1><p><img src="https://github.com/losemyheaven/image-bank/raw/master/ssh/ssh-D.jpg" alt="enter image description here"></p>
<blockquote>
<p><strong>-D</strong><br>[_ bind_address_:]<em>port</em><br>Specifies a local ‘’dynamic’’ application-level port forwarding. This works by allocating a socket to listen to  <em>port</em>  on the local side, optionally bound to the specified  _bind_address_. Whenever a connection is made to this port, the connection is forwarded over the secure channel, and the application protocol is then used to determine where to connect to from the remote machine. Currently the SOCKS4 and SOCKS5 protocols are supported, and  <strong>ssh</strong>  will act as a SOCKS server. Only root can forward privileged ports. Dynamic port forwardings can also be specified in the configuration file.</p>
</blockquote>
<p>ssh dynamic port mapping, often used to work around GFW throught your vpn tunnel.<br>Given that your local machine could connect through vpn to one of PCs in your working LAN, execute<br><code>ssh -D 1080 remote_ip</code><br>Now you have a SOCK proxy. Afterwards, each connecting attemp will be actually done by your remote PC which then returns data sent from internet website server to your local machine.<br>Here also an address translation mapping is involved.</p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul>
<li><a href="https://linux.die.net/man/1/ssh" target="_blank" rel="noopener">https://linux.die.net/man/1/ssh</a></li>
<li><a href="https://www.cnblogs.com/eshizhan/archive/2012/07/16/2592902.html" target="_blank" rel="noopener">https://www.cnblogs.com/eshizhan/archive/2012/07/16/2592902.html</a></li>
<li><a href="http://blog.creke.net/722.html" target="_blank" rel="noopener">http://blog.creke.net/722.html</a></li>
</ul>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/port/" rel="tag"># port</a>
          
            <a href="/tags/ssh/" rel="tag"># ssh</a>
          
            <a href="/tags/map/" rel="tag"># map</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/04/23/How-pacemaker-inside-works/" rel="next" title="How pacemaker inside works">
                <i class="fa fa-chevron-left"></i> How pacemaker inside works
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/05/07/how-to-access-kvm-machine-through-text-console-from-within-virsh-console/" rel="prev" title="how to access kvm machine through text console from within virsh console">
                how to access kvm machine through text console from within virsh console <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Larry Chen</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">categories</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">12</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#SSH-port-mapping"><span class="nav-number">1.</span> <span class="nav-text">SSH port mapping</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#SSH-local-port-mapping"><span class="nav-number">1.1.</span> <span class="nav-text">SSH local port mapping</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Usage"><span class="nav-number">1.1.1.</span> <span class="nav-text">Usage:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Note-that-there-is-an-address-change-in-step-3-why-such-a-change-is-needed"><span class="nav-number">1.1.2.</span> <span class="nav-text">Note that there is an address change in step 3, why such a change is needed?</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SSH-remote-port-mapping"><span class="nav-number">1.2.</span> <span class="nav-text">SSH remote port mapping</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SSH-dynamic-port-mapping"><span class="nav-number">2.</span> <span class="nav-text">SSH dynamic port mapping</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Reference"><span class="nav-number">3.</span> <span class="nav-text">Reference</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Larry Chen</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
